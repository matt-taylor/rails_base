var SessionsSingleton=function(){var e=function(){return{sessionTimoutClock:undefined,reminderClock:undefined,reminderTime:6e4,timeout:undefined,url_get:undefined,url_post:undefined,ajax_timing:undefined,init:function(e,n,i,t,o){var r=this;if(r.timeout=1e3*e,r.url_get=n,r.url_post=i,r.csrf=t,r.show_warning=o,r.logging(`Initialized. timeout ${r.timeout}`),r.sessionTimoutClock=window.setTimeout(function(){return r.checkForWarning()},r.timeout+500),r.show_warning)return r.reminderClock=window.setTimeout(function(){return r.checkForWarning()},r.timeout-r.reminderTime)},checkForWarning:function(){var e=this;e.ajax_timing=new Date,e.logging("Heartbeat warning"),$.ajax({type:"GET",url:e.url_get,success:function(n){e.logging(`TTL check success: ${JSON.stringify(n)}`),e.warningHeartbeatSuccess(n)},error:function(){return e.logging("TTL check failed. Reloading page"),e.doRedirect()}})},checkForSessionHeartbeat:function(){var e=this;e.ajax_timing=new Date,$.ajax({type:"GET",url:e.url_get,success:function(n){e.logging(`TTL check success: ${JSON.stringify(n)}`),e.ajaxPollTtlServer(n)},error:function(){return e.logging("TTL check failed. Reloading page"),e.doRedirect()}})},latency:function(){var e=this;return new Date-e.ajax_timing},warningHeartbeatSuccess:function(e){var n=this,i=1e3*e.ttl,t=n.latency(),o=i-n.reminderTime;n.logging(`latency ${t}ms`),n.logging(`skew ${o}ms`),o>5e3?(n.logging("Skew is high. Resetting clock"),n.resetClock(i),closeSessionWarning()):(n.logging("Within skew. Showing countdown"),showSessionWarning(e.ttl))},ajaxPollTtlServer:function(){var e=this;e.ajax_timing=new Date,$.ajax({type:"POST",url:e.url_post,headers:{"X-CSRF-Token":e.csrf},success:function(n){return e.logging(`POST Heartbeat success: ${JSON.stringify(n)}`),closeSessionWarning(),e.resetClock(1e3*n.ttl)},error:function(){return e.logging("POST TTL check failed. Reloading page"),e.doRedirect()}})},doRedirect:function(){return window.location.search+="&timeout"},resetClock:function(e){var n=this;e/=1e3;n.logging(`Clock Reset timout: ${e}`);var i=n.url_get,t=n.url_post,o=n.csrf,r=n.show_warning;return n.destroy(),n.init(e,i,t,o,r)},destroy:function(){var e=this;window.clearTimeout(e.reminderClock),window.clearTimeout(e.sessionTimoutClock),e.sessionTimoutClock=undefined,e.reminderClock=undefined,e.timeout=undefined},logging:function(e){console.log(`${(new Date).toJSON()}: SessionManager - ${e}`)}}},n=undefined;return{getInstance:function(){return null==n&&((n=new e).constructor=null),n}}}(),sessionManager=SessionsSingleton.getInstance();